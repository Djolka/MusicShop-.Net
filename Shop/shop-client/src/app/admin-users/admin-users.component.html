<div class="container-fluid">
    <div class="row">

        <!-- LEFT SIDE: Users -->
        <div class="col-lg-5">
            <div class="user_container">
                <div *ngFor="let user of usersList" class="user_items">
                    <ul class="user_list" [class.selected]="user === selectedUser">
                        <li class="user_item clearfix">
                            <div class="card-body pt-0">
                                <div class="widget-49">
                                    <div class="widget-49-title-wrapper">
                                        <div class="widget-49-date-primary">
                                            <span class="widget-49-date-day">{{ user.role }}</span>
                                        </div>
                                        <div class="widget-49-meeting-info">
                                            <span class="widget-49-pro-title">ID: <b>{{ user.id }}</b></span>
                                            <span class="widget-49-pro-title">Full Name: {{ user.name }} {{
                                                user.lastName }}</span>
                                            <span class="widget-49-pro-title">Email: {{ user.email }}</span>
                                        </div>
                                    </div>
                                    <div class="widget-49-meeting-action">
                                        <a *ngIf="user.role != 'Admin'" (click)="onOrdersClick(user)"
                                            [ngClass]="{ 'selected-button': selectedUserId === user.id && selectedButton === 'orders' }"
                                            class="btn btn-sm btn-flash-border-primary">Orders</a>
                                        <a *ngIf="user.role != 'Admin'" (click)="onFavouritesClick(user)"
                                            [ngClass]="{ 'selected-button': selectedUserId === user.id && selectedButton === 'favourites' }"
                                            class="btn btn-sm btn-flash-border-primary">Favourites</a>
                                        <a (click)="onChangeRoleClick(user)"
                                            [ngClass]="{ 'selected-button': selectedUserId === user.id && selectedButton === 'changeRole' }"
                                            class="btn btn-sm btn-flash-border-primary">Change role</a>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE: Orders -->
        <div *ngIf="selectedButton === 'orders'" class="col-lg-7">
            <div *ngIf="selectedUser && userOrdersList.length === 0" class="d-flex justify-content-center mt-5">
                <h4>This user has no orders</h4>
            </div>

            <div *ngIf="userOrdersList.length !== 0">
                <div *ngFor="let order of userOrdersList" class="order-card mb-2 p-2">
                    <div class="widget-49">
                        <div class="widget-49-title-wrapper">
                            <div class="widget-49-date-primary">
                                <span class="widget-49-date-day">{{ order.date | date: 'd.MMM' }}</span>
                            </div>
                            <div class="widget-49-meeting-info">
                                <span class="widget-49-pro-title">Order ID: <b>{{ order.id }}</b></span>
                                <span class="widget-49-meeting-time">{{ order.date | date:'dd-MM-yyyy, HH:mm': 'GMT+2'
                                    }}</span>
                            </div>
                        </div>

                        <ul class="widget-49-meeting-points">
                            <li class="widget-49-meeting-item">
                                <span>No. of items: {{ order.orderProducts.length }}</span>
                            </li>
                            <li class="widget-49-meeting-item">
                                <span>Total price: {{ order.totalPrice | currency:'EUR' }}</span>
                            </li>
                        </ul>
                    </div>
                    <span class="order-status" [ngClass]="order.isVerified ? 'completed' : 'pending'">
                        <i class="status-icon" [ngClass]="order.isVerified ? 'icon-completed' : 'icon-pending'"></i>
                        {{ order.isVerified ? 'Completed' : 'Pending' }}
                    </span>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE: Favourites -->
        <div *ngIf="selectedButton === 'favourites'" class="col-lg-7">
            <!-- Empty State -->
            <div *ngIf="selectedUser && userFavouritesList.length === 0"
                class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
                <div class="text-center">
                    <i class="fas fa-heart text-muted mb-2" style="font-size: 2rem;"></i>
                    <h5 class="text-muted mb-1">This user has no favourites</h5>
                </div>
            </div>

            <!-- Favourites List -->
            <div *ngIf="userFavouritesList.length > 0" class="favourites-container">
                <div class="row g-3">
                    <div *ngFor="let item of userFavouritesList" class="col-12">
                        <div class="card favourite-card border-0 shadow-sm mb-3">
                            <div class="card-body p-3">
                                <div class="row align-items-center">
                                    <!-- Product Image -->
                                    <div class="col-2">
                                        <div class="position-relative">
                                            <img [src]="item?.product?.picture[0] || 'assets/images/placeholder.jpg'"
                                                class="favourite-img rounded-2" alt="{{ item.product.name }}"
                                                onerror="this.src='assets/images/placeholder.jpg'">
                                        </div>
                                    </div>

                                    <!-- Product Details -->
                                    <div class="col-6">
                                        <h6 class="card-title fw-bold text-dark mb-1 small">{{ item.product.name }}</h6>

                                        <div class="product-meta mb-1">
                                            <small class="text-muted">
                                                <span class="fw-medium">{{ item.product.manufacturer }}</span>
                                                <span class="mx-1">•</span>
                                                <span>{{ item.product.color }}</span>
                                                <span class="mx-1">•</span>
                                                <span>{{ item.product.countryOfOrigin }}</span>
                                            </small>
                                        </div>

                                        <div class="product-type mb-1">
                                            <span class="badge bg-light text-dark border small">
                                                <span [ngSwitch]="item.product.type">
                                                    <span *ngSwitchCase="'acousticguitar'">Acoustic Guitar</span>
                                                    <span *ngSwitchCase="'electricguitar'">Electric Guitar</span>
                                                    <span *ngSwitchCase="'bassguitar'">Bass Guitar</span>
                                                    <span *ngSwitchCase="'soprano'">Soprano Ukulele</span>
                                                    <span *ngSwitchCase="'concert'">Concert Ukulele</span>
                                                    <span *ngSwitchCase="'tenor'">Tenor Ukulele</span>
                                                    <span *ngSwitchCase="'acousticdrums'">Acoustic Drums</span>
                                                    <span *ngSwitchCase="'electronicdrums'">Electronic Drums</span>
                                                    <span *ngSwitchCase="'synthesizer'">Synthesizer</span>
                                                    <span *ngSwitchCase="'acousticamp'">Acoustic Amp</span>
                                                    <span *ngSwitchCase="'electricamp'">Electric Amp</span>
                                                    <span *ngSwitchCase="'bassamp'">Bass Amp</span>
                                                    <span *ngSwitchCase="'microphone'">Microphone</span>
                                                    <span *ngSwitchCase="'strings'">Strings</span>
                                                    <span *ngSwitchCase="'capo'">Capo</span>
                                                </span>
                                            </span>
                                        </div>

                                        <p class="card-text text-muted small mb-0 line-clamp-2">
                                            {{ item.product.description }}
                                        </p>
                                    </div>

                                    <!-- Price and Actions -->
                                    <div class="col-4">
                                        <div class="d-flex flex-column align-items-end h-100">
                                            <div class="text-end mb-2">
                                                <h6 class="text-primary fw-bold mb-0">
                                                    {{ item.product.price | currency:'EUR' }}
                                                </h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE: Change Role -->
        <div *ngIf="selectedButton === 'changeRole'" class="col-lg-5">
            <div *ngIf="!selectedUser" class="d-flex justify-content-center mt-5">
                <h4>Select a user to change role</h4>
            </div>

            <div *ngIf="selectedUser" class="role-card-container mt-3">
                <h5 class="mb-3">Change Role for: <b>{{ selectedUser.name }} {{ selectedUser.lastName }}</b></h5>

                <div class="d-flex gap-3">
                    <!-- Admin Card -->
                    <button class="role-card shadow-sm border rounded-3 text-center p-3 flex-fill"
                        [ngClass]="{'active-role': selectedUser.role === 'Admin'}"
                        [disabled]="selectedUser.role === 'Admin'" (click)="saveUserRole(selectedUser, 'Admin')">
                        <i class="fas fa-user-shield fa-2x mb-2 text-primary"></i>
                        <div>Admin</div>
                    </button>

                    <!-- User Card -->
                    <button class="role-card shadow-sm border rounded-3 text-center p-3 flex-fill"
                        [ngClass]="{'active-role': selectedUser.role === 'User'}"
                        [disabled]="selectedUser.role === 'User'" (click)="saveUserRole(selectedUser, 'User')">
                        <i class="fas fa-user fa-2x mb-2 text-secondary"></i>
                        <div>User</div>
                    </button>
                </div>
            </div>
        </div>


    </div>
</div>